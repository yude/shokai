<!DOCTYPE html>
<html>

<head>
  <title>{{.hostname}}</title>
</head>

<body>
    <main style="max-width: 30em; margin-left: auto; margin-right: auto">
    <div style="margin-bottom: 5px">
        <span style="display: block; font-size: 2em">{{.hostname}}</span>
        <span>This server is running at {{.location}}.</span>
    </div>
    <div style="margin-bottom: 5px">
        <span style="display: block; font-size: 1.3em">About this server</span>
        <ul>
            <li>Platform: {{.platform}} ({{.arch}})</li>
            <li>CPU: {{.cpu}}</li>
        </ul>
        <span style="display: block; font-size: 1.3em">Operating status</span>
        <ul>
            <li>Load average: {{.loadavg}}</li>
            <li>RAM: {{.ram_used}}% used</li>
        </ul>
        <span style="display: block; font-size: 1.3em">Reachability from here</span>
        <ul id="reach">
            Loading...
        </ul>
    </div>
    <div style="margin-bottom: 5px">
        <span style="display: block; font-size: 1.3em">About you</span>
        <ul>
            <li>Source: {{.client_ip}}:{{.client_port}} ({{.client_source}})</li>
            <li>Host: {{.client_host}}</li>
        </ul>
    </div>
    <small>
        Data displayed on this page may contain personal information. Please be careful when sharing its content.
    </small>
</main>

<script async>
    const url = '/reach'

    fetch(url)
        .then(function(res) {
            return res.text();
        })
        .then(function(text) {
            obj = JSON.parse(text);
            let list_body = [];
            for (let i = 0; i < obj.length; i++) {
                if (obj[i].Reached) {
                    reached = "✅"
                } else {
                    reached = "❌"
                }

                obj[i].Destination = obj[i].Destination.replace("https://", "")
                obj[i].Destination = obj[i].Destination.replace("http://", "")

                list_body.push('<li>' + obj[i].Destination + ": " + reached + '</li>')
            }

            let target = document.getElementById("reach");
            target.innerHTML = list_body.join('');
        })
        
</script>

</body>

</html>
